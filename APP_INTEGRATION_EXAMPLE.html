<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‡‰ç”¨ç¨‹å¼æ•´åˆç¯„ä¾‹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
        }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ æ‡‰ç”¨ç¨‹å¼æ•´åˆç¯„ä¾‹</h1>
    
    <div class="section">
        <h2>1. åŸºæœ¬è¨­å®š</h2>
        <p>é¦–å…ˆï¼Œè¨­å®šæ‚¨çš„ API åŸºç¤ URLï¼š</p>
        <div class="code">
const API_BASE_URL = 'https://your-render-app.onrender.com';
// æˆ–è€…ä½¿ç”¨æœ¬åœ°é–‹ç™¼
// const API_BASE_URL = 'http://localhost:3000';
        </div>
    </div>

    <div class="section">
        <h2>2. ç™»å…¥æ•´åˆ</h2>
        <p>åœ¨æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­åŠ å…¥ç™»å…¥åŠŸèƒ½ï¼š</p>
        <div class="code">
async function loginUser(username, password) {
    try {
        const response = await fetch(`${API_BASE_URL}/api/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // å„²å­˜ token
            localStorage.setItem('authToken', data.token);
            localStorage.setItem('userData', JSON.stringify(data.user));
            
            // è·³è½‰åˆ°æ‡‰ç”¨ç¨‹å¼ä¸»é 
            window.location.href = '/app-dashboard.html';
            return { success: true, user: data.user };
        } else {
            return { success: false, error: data.error };
        }
    } catch (error) {
        return { success: false, error: 'ç¶²è·¯éŒ¯èª¤' };
    }
}
        </div>
        
        <button class="button" onclick="testLogin()">æ¸¬è©¦ç™»å…¥</button>
    </div>

    <div class="section">
        <h2>3. è¨»å†Šæ•´åˆ</h2>
        <p>åœ¨æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­åŠ å…¥è¨»å†ŠåŠŸèƒ½ï¼š</p>
        <div class="code">
async function registerUser(username, email, password) {
    try {
        const response = await fetch(`${API_BASE_URL}/api/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, email, password })
        });
        
        const data = await response.json();
        return data;
    } catch (error) {
        return { success: false, error: 'è¨»å†Šå¤±æ•—' };
    }
}

async function sendVerificationCode(email) {
    try {
        const response = await fetch(`${API_BASE_URL}/api/send-verification-code`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        return data;
    } catch (error) {
        return { success: false, error: 'ç™¼é€é©—è­‰ç¢¼å¤±æ•—' };
    }
}

async function verifyCode(email, code) {
    try {
        const response = await fetch(`${API_BASE_URL}/api/verify-code`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, code })
        });
        
        const data = await response.json();
        
        if (data.success) {
            localStorage.setItem('authToken', data.token);
            return { success: true, token: data.token };
        } else {
            return { success: false, error: data.error };
        }
    } catch (error) {
        return { success: false, error: 'é©—è­‰å¤±æ•—' };
    }
}
        </div>
        
        <button class="button" onclick="testRegister()">æ¸¬è©¦è¨»å†Š</button>
    </div>

    <div class="section">
        <h2>4. èªè­‰æª¢æŸ¥</h2>
        <p>åœ¨æ¯å€‹éœ€è¦èªè­‰çš„é é¢åŠ å…¥æª¢æŸ¥ï¼š</p>
        <div class="code">
async function checkAuthentication() {
    const token = localStorage.getItem('authToken');
    
    if (!token) {
        // æœªç™»å…¥ï¼Œè·³è½‰åˆ°ç™»å…¥é é¢
        window.location.href = '/login.html';
        return false;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/me`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            // å·²ç™»å…¥ï¼Œé¡¯ç¤ºç”¨æˆ¶è³‡æ–™
            displayUserInfo(data.user);
            return true;
        } else {
            // Token ç„¡æ•ˆï¼Œæ¸…é™¤ä¸¦è·³è½‰
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            window.location.href = '/login.html';
            return false;
        }
    } catch (error) {
        // ç¶²è·¯éŒ¯èª¤ï¼Œæ¸…é™¤ä¸¦è·³è½‰
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
        window.location.href = '/login.html';
        return false;
    }
}

// é é¢è¼‰å…¥æ™‚æª¢æŸ¥èªè­‰
document.addEventListener('DOMContentLoaded', function() {
    checkAuthentication();
});
        </div>
    </div>

    <div class="section">
        <h2>5. ç™»å‡ºåŠŸèƒ½</h2>
        <p>åœ¨æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­åŠ å…¥ç™»å‡ºåŠŸèƒ½ï¼š</p>
        <div class="code">
function logout() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('userData');
    window.location.href = '/login.html';
}
        </div>
        
        <button class="button" onclick="testLogout()">æ¸¬è©¦ç™»å‡º</button>
    </div>

    <div class="section">
        <h2>6. å®Œæ•´çš„æ‡‰ç”¨ç¨‹å¼ç¯„ä¾‹</h2>
        <p>é€™æ˜¯ä¸€å€‹å®Œæ•´çš„æ‡‰ç”¨ç¨‹å¼æ•´åˆç¯„ä¾‹ï¼š</p>
        <div class="code">
// app.js - æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸»æª”æ¡ˆ

class AppAuth {
    constructor(apiBaseUrl) {
        this.apiBaseUrl = apiBaseUrl;
        this.token = localStorage.getItem('authToken');
    }
    
    // ç™»å…¥
    async login(username, password) {
        try {
            const response = await fetch(`${this.apiBaseUrl}/api/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            });
            
            const data = await response.json();
            
            if (data.success) {
                this.token = data.token;
                localStorage.setItem('authToken', data.token);
                localStorage.setItem('userData', JSON.stringify(data.user));
                return { success: true, user: data.user };
            } else {
                return { success: false, error: data.error };
            }
        } catch (error) {
            return { success: false, error: 'ç™»å…¥å¤±æ•—' };
        }
    }
    
    // æª¢æŸ¥èªè­‰
    async checkAuth() {
        if (!this.token) {
            return { authenticated: false };
        }
        
        try {
            const response = await fetch(`${this.apiBaseUrl}/api/me`, {
                headers: {
                    'Authorization': `Bearer ${this.token}`
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                return { authenticated: true, user: data.user };
            } else {
                this.logout();
                return { authenticated: false };
            }
        } catch (error) {
            this.logout();
            return { authenticated: false };
        }
    }
    
    // ç™»å‡º
    logout() {
        this.token = null;
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
    }
    
    // ç²å–ç”¨æˆ¶è³‡æ–™
    getUser() {
        const userData = localStorage.getItem('userData');
        return userData ? JSON.parse(userData) : null;
    }
}

// åˆå§‹åŒ–èªè­‰ç³»çµ±
const auth = new AppAuth('https://your-render-app.onrender.com');

// åœ¨æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨
async function initApp() {
    const authStatus = await auth.checkAuth();
    
    if (authStatus.authenticated) {
        // ç”¨æˆ¶å·²ç™»å…¥ï¼Œé¡¯ç¤ºæ‡‰ç”¨ç¨‹å¼å…§å®¹
        showAppContent(authStatus.user);
    } else {
        // ç”¨æˆ¶æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥è¡¨å–®
        showLoginForm();
    }
}

// å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
initApp();
        </div>
    </div>

    <div class="section">
        <h2>7. ç’°å¢ƒè¨­å®š</h2>
        <p>æ ¹æ“šä¸åŒç’°å¢ƒè¨­å®š API URLï¼š</p>
        <div class="code">
// é–‹ç™¼ç’°å¢ƒ
const DEV_API_URL = 'http://localhost:3000';

// ç”Ÿç”¢ç’°å¢ƒ (Render)
const PROD_API_URL = 'https://your-render-app.onrender.com';

// æ ¹æ“šç’°å¢ƒé¸æ“‡ API URL
const API_BASE_URL = window.location.hostname === 'localhost' 
    ? DEV_API_URL 
    : PROD_API_URL;
        </div>
    </div>

    <script>
        // æ¸¬è©¦å‡½æ•¸
        async function testLogin() {
            const result = await loginUser('testuser', 'password123');
            alert(result.success ? 'ç™»å…¥æˆåŠŸï¼' : 'ç™»å…¥å¤±æ•—ï¼š' + result.error);
        }
        
        async function testRegister() {
            const result = await registerUser('newuser', 'newuser@example.com', 'password123');
            alert(result.success ? 'è¨»å†ŠæˆåŠŸï¼' : 'è¨»å†Šå¤±æ•—ï¼š' + result.error);
        }
        
        function testLogout() {
            logout();
            alert('å·²ç™»å‡ºï¼');
        }
        
        // æ¨¡æ“¬å‡½æ•¸
        async function loginUser(username, password) {
            return { success: true, user: { username, email: 'test@example.com' } };
        }
        
        async function registerUser(username, email, password) {
            return { success: true, message: 'è¨»å†ŠæˆåŠŸ' };
        }
        
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
        }
    </script>
</body>
</html> 