<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªè­‰æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” èªè­‰æ¸¬è©¦é é¢</h1>
        
        <div id="tokenStatus" class="status info">
            æª¢æŸ¥ä¸­...
        </div>
        
        <div id="apiStatus" class="status info">
            API æª¢æŸ¥ä¸­...
        </div>
        
        <div id="actions">
            <button onclick="checkToken()">æª¢æŸ¥ Token</button>
            <button onclick="clearToken()">æ¸…é™¤ Token</button>
            <button onclick="testLogin()">æ¸¬è©¦ç™»å…¥</button>
        </div>
        
        <div id="results"></div>
    </div>
    
    <script>
        // æª¢æŸ¥ token ç‹€æ…‹
        function checkToken() {
            const token = localStorage.getItem('token');
            const statusDiv = document.getElementById('tokenStatus');
            
            if (token) {
                statusDiv.textContent = 'âœ… Token å­˜åœ¨: ' + token.substring(0, 20) + '...';
                statusDiv.className = 'status success';
            } else {
                statusDiv.textContent = 'âŒ Token ä¸å­˜åœ¨';
                statusDiv.className = 'status error';
            }
        }
        
        // æ¸…é™¤ token
        function clearToken() {
            localStorage.removeItem('token');
            localStorage.removeItem('staffName');
            localStorage.removeItem('staffRole');
            checkToken();
        }
        
        // æ¸¬è©¦ç™»å…¥
        async function testLogin() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="status info">æ¸¬è©¦ç™»å…¥ä¸­...</div>';
            
            try {
                const response = await fetch('https://echochat-api.onrender.com/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem('token', data.token);
                    resultsDiv.innerHTML = '<div class="status success">âœ… ç™»å…¥æˆåŠŸï¼Token å·²å„²å­˜</div>';
                    checkToken();
                } else {
                    resultsDiv.innerHTML = '<div class="status error">âŒ ç™»å…¥å¤±æ•—: ' + (data.error || 'æœªçŸ¥éŒ¯èª¤') + '</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="status error">âŒ ç¶²è·¯éŒ¯èª¤: ' + error.message + '</div>';
            }
        }
        
        // æª¢æŸ¥ API ç‹€æ…‹
        async function checkApiStatus() {
            const apiStatusDiv = document.getElementById('apiStatus');
            
            try {
                const response = await fetch('https://echochat-api.onrender.com/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    apiStatusDiv.textContent = 'âœ… API æ­£å¸¸: ' + data.message;
                    apiStatusDiv.className = 'status success';
                } else {
                    apiStatusDiv.textContent = 'âŒ API ç•°å¸¸: ' + response.status;
                    apiStatusDiv.className = 'status error';
                }
            } catch (error) {
                apiStatusDiv.textContent = 'âŒ API é€£æ¥å¤±æ•—: ' + error.message;
                apiStatusDiv.className = 'status error';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œæª¢æŸ¥
        window.onload = function() {
            checkToken();
            checkApiStatus();
        };
    </script>
</body>
</html>