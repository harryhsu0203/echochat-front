<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API é€£æ¥æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="js/api-config.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-card">
            <h2 class="text-center mb-4">ğŸ” API é€£æ¥æ¸¬è©¦</h2>
            
            <div id="testResults"></div>
            
            <div class="text-center mt-4">
                <button class="btn btn-primary" onclick="runTests()">é‡æ–°æ¸¬è©¦</button>
                <a href="login.html" class="btn btn-secondary ms-2">è¿”å›ç™»å…¥é é¢</a>
            </div>
        </div>
    </div>

    <script>
        async function runTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div><p>æ¸¬è©¦ä¸­...</p></div>';
            
            const results = [];
            
            // æ¸¬è©¦ 1: API å¥åº·æª¢æŸ¥
            try {
                console.log('ğŸ” æ¸¬è©¦ API å¥åº·æª¢æŸ¥...');
                const healthResponse = await fetch(`${API_BASE_URL}/health`);
                const healthData = await healthResponse.json();
                
                results.push({
                    name: 'API å¥åº·æª¢æŸ¥',
                    status: healthResponse.ok ? 'success' : 'error',
                    message: healthResponse.ok ? 'API ä¼ºæœå™¨é‹è¡Œæ­£å¸¸' : `HTTP ${healthResponse.status}`,
                    details: healthData
                });
            } catch (error) {
                results.push({
                    name: 'API å¥åº·æª¢æŸ¥',
                    status: 'error',
                    message: 'ç„¡æ³•é€£æ¥åˆ° API ä¼ºæœå™¨',
                    details: error.message
                });
            }
            
            // æ¸¬è©¦ 2: ç™»å…¥ç«¯é»
            try {
                console.log('ğŸ” æ¸¬è©¦ç™»å…¥ç«¯é»...');
                const loginResponse = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'test',
                        password: 'test'
                    })
                });
                
                results.push({
                    name: 'ç™»å…¥ç«¯é»',
                    status: loginResponse.status === 401 ? 'warning' : 'success',
                    message: loginResponse.status === 401 ? 'ç«¯é»æ­£å¸¸ï¼ˆé æœŸçš„èªè­‰å¤±æ•—ï¼‰' : `HTTP ${loginResponse.status}`,
                    details: `ç‹€æ…‹ç¢¼: ${loginResponse.status}`
                });
            } catch (error) {
                results.push({
                    name: 'ç™»å…¥ç«¯é»',
                    status: 'error',
                    message: 'ç„¡æ³•é€£æ¥åˆ°ç™»å…¥ç«¯é»',
                    details: error.message
                });
            }
            
            // æ¸¬è©¦ 3: CORS è¨­å®š
            try {
                console.log('ğŸ” æ¸¬è©¦ CORS è¨­å®š...');
                const corsResponse = await fetch(`${API_BASE_URL}/health`, {
                    method: 'OPTIONS'
                });
                
                results.push({
                    name: 'CORS è¨­å®š',
                    status: 'success',
                    message: 'CORS è¨­å®šæ­£å¸¸',
                    details: 'å…è¨±è·¨åŸŸè«‹æ±‚'
                });
            } catch (error) {
                results.push({
                    name: 'CORS è¨­å®š',
                    status: 'error',
                    message: 'CORS è¨­å®šå¯èƒ½æœ‰å•é¡Œ',
                    details: error.message
                });
            }
            
            // é¡¯ç¤ºçµæœ
            displayResults(results);
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('testResults');
            let html = '<div class="mb-3">';
            
            results.forEach(result => {
                const statusClass = `status-${result.status}`;
                const statusText = {
                    'success': 'âœ… æˆåŠŸ',
                    'warning': 'âš ï¸ è­¦å‘Š',
                    'error': 'âŒ éŒ¯èª¤'
                }[result.status];
                
                html += `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">
                                <span class="status-indicator ${statusClass}"></span>
                                ${result.name}
                            </h6>
                            <p class="card-text">${result.message}</p>
                            <small class="text-muted">${JSON.stringify(result.details, null, 2)}</small>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html> 