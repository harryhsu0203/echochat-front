<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>立即進入系統 - EchoChat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Microsoft JhengHei', sans-serif;
        }
        .instant-card {
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        .btn-instant {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px;
            width: 100%;
        }
        .btn-instant:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
            color: white;
        }
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="instant-card">
        <h1 class="text-success mb-4">
            <i class="fas fa-rocket me-3"></i>立即進入系統
        </h1>
        <p class="lead mb-4">不需要密碼，直接進入您的管理後台</p>
        
        <div class="d-grid gap-3">
            <button class="btn btn-instant" onclick="instantLogin()">
                <i class="fas fa-sign-in-alt me-3"></i>立即進入 (sunnyharry1)
            </button>
        </div>
        
        <div id="successMessage" class="success-message">
            <h5><i class="fas fa-check-circle me-2"></i>登入成功！</h5>
            <p class="mb-3">您已成功登入系統，現在可以使用所有功能。</p>
            <div class="d-grid gap-2">
                <a href="dashboard-no-redirect.html" class="btn btn-success">
                    <i class="fas fa-tachometer-alt me-2"></i>進入儀表板
                </a>
                <a href="account-management.html" class="btn btn-primary">
                    <i class="fas fa-users me-2"></i>帳號管理
                </a>
            </div>
        </div>
        
        <div class="mt-4 text-muted">
            <small>
                <i class="fas fa-info-circle me-2"></i>
                此方法繞過後端認證，直接設置前端登入狀態
            </small>
        </div>
    </div>

    <script>
        function instantLogin() {
            // 設置完整的登入狀態
            const userData = {
                id: 1,
                username: 'sunnyharry1',
                name: '系統管理員',
                role: 'admin',
                email: 'sunnyharry1@echochat.com'
            };
            
            // 生成一個看起來真實的 JWT token
            const header = btoa(JSON.stringify({alg: "HS256", typ: "JWT"}));
            const payload = btoa(JSON.stringify({
                id: userData.id,
                username: userData.username,
                name: userData.name,
                role: userData.role,
                exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24小時後過期
            }));
            const signature = btoa('fake-signature-for-frontend-display');
            const token = `${header}.${payload}.${signature}`;
            
            // 設置所有必要的 localStorage 項目
            localStorage.setItem('token', token);
            localStorage.setItem('staffName', userData.name);
            localStorage.setItem('staffRole', userData.role);
            localStorage.setItem('staffUsername', userData.username);
            localStorage.setItem('staffId', userData.id.toString());
            localStorage.setItem('staffEmail', userData.email);
            localStorage.setItem('loginTime', new Date().toISOString());
            localStorage.setItem('isLoggedIn', 'true');
            
            // 也設置 sessionStorage
            sessionStorage.setItem('userLoggedIn', 'true');
            sessionStorage.setItem('currentUser', JSON.stringify(userData));
            
            // 顯示成功消息
            document.getElementById('successMessage').style.display = 'block';
            
            // 3秒後自動跳轉到儀表板
            setTimeout(() => {
                window.location.href = 'dashboard-no-redirect.html';
            }, 3000);
            
            console.log('✅ 登入狀態已設置完成');
            console.log('Token:', token);
            console.log('用戶資料:', userData);
        }
        
        // 頁面載入時檢查是否已登入
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            
            if (token && isLoggedIn === 'true') {
                document.getElementById('successMessage').style.display = 'block';
                document.querySelector('.btn-instant').innerHTML = '<i class="fas fa-check me-3"></i>已登入 - 點擊重新設置';
                
                // 顯示當前登入狀態
                const username = localStorage.getItem('staffUsername');
                const name = localStorage.getItem('staffName');
                document.querySelector('.lead').innerHTML = `當前已登入：${name} (${username})`;
            }
        });
    </script>
</body>
</html>