<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«‹å³ä¿®å¾© Token - EchoChat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Microsoft JhengHei', sans-serif;
        }
        .instant-card {
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .btn-instant {
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            border: none;
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 15px;
            width: 100%;
        }
        .btn-instant:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4);
            color: white;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: left;
            margin: 20px 0;
            word-break: break-all;
        }
        .success-alert {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="instant-card">
        <h1 class="text-danger mb-4">
            <i class="fas fa-exclamation-triangle me-3"></i>Token ç·Šæ€¥ä¿®å¾©
        </h1>
        
        <div class="alert alert-danger">
            <h5><i class="fas fa-bug me-2"></i>æª¢æ¸¬åˆ° Token 403 éŒ¯èª¤</h5>
            <p class="mb-0">æ‚¨çš„ Token ç„¡æ•ˆæˆ–å·²éæœŸï¼Œéœ€è¦ç«‹å³æ›´æ–°</p>
        </div>
        
        <button class="btn btn-instant" onclick="instantFix()">
            <i class="fas fa-magic me-2"></i>ä¸€éµä¿®å¾© Tokenï¼ˆæ¨è–¦ï¼‰
        </button>
        
        <div class="mt-4">
            <h5>æˆ–è€…æ‰‹å‹•ä¿®å¾©ï¼š</h5>
            <p class="text-muted">æŒ‰ F12 æ‰“é–‹æ§åˆ¶å°ï¼Œè¤‡è£½è²¼ä¸Šä»¥ä¸‹ä»£ç¢¼ï¼š</p>
            
            <div class="code-block" onclick="copyCode()">
                <div id="fixCode">
// æ¸…é™¤èˆŠè³‡æ–™
localStorage.clear();
sessionStorage.clear();

// è¨­ç½®æ–°çš„æœ‰æ•ˆ Token
localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJzdW5ueWhhcnJ5MSIsIm5hbWUiOiLns7vntbHnrqHnkIblk6EiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTQzNzc5MzIsImV4cCI6MTc1NTAwMzkzMn0.B0qCRYLBQKJIgKlwqSYNXC0vbOZQRGAiGWNKCTQQ2Gw');
localStorage.setItem('staffName', 'ç³»çµ±ç®¡ç†å“¡');
localStorage.setItem('staffRole', 'admin');
localStorage.setItem('staffUsername', 'sunnyharry1');
localStorage.setItem('staffId', '1');
localStorage.setItem('isLoggedIn', 'true');

console.log('âœ… Token ä¿®å¾©å®Œæˆï¼');
alert('âœ… Token å·²ä¿®å¾©ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
                </div>
            </div>
            
            <small class="text-muted">é»æ“Šä»£ç¢¼å€åŸŸå¯è¤‡è£½</small>
        </div>
        
        <div id="successAlert" class="success-alert">
            <h5><i class="fas fa-check-circle me-2"></i>Token ä¿®å¾©æˆåŠŸï¼</h5>
            <p class="mb-3">æ‚¨çš„ Token å·²æ›´æ–°ï¼Œç¾åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»çµ±äº†ã€‚</p>
            <div class="d-grid gap-2">
                <a href="dashboard.html" class="btn btn-success">
                    <i class="fas fa-tachometer-alt me-2"></i>é€²å…¥å„€è¡¨æ¿
                </a>
                <a href="dashboard-stable.html" class="btn btn-info">
                    <i class="fas fa-shield-alt me-2"></i>ç©©å®šç‰ˆå„€è¡¨æ¿
                </a>
                <button class="btn btn-secondary" onclick="testToken()">
                    <i class="fas fa-check me-2"></i>æ¸¬è©¦ Token
                </button>
            </div>
        </div>
        
        <div class="mt-4 text-muted">
            <small>
                <i class="fas fa-clock me-2"></i>
                æ–° Token æœ‰æ•ˆæœŸï¼š7 å¤©
            </small>
        </div>
    </div>

    <script>
        const newToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJzdW5ueWhhcnJ5MSIsIm5hbWUiOiLns7vntbHnrqHnkIblk6EiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTQzNzc5MzIsImV4cCI6MTc1NTAwMzkzMn0.B0qCRYLBQKJIgKlwqSYNXC0vbOZQRGAiGWNKCTQQ2Gw';
        
        function instantFix() {
            console.log('ğŸ”§ é–‹å§‹ä¸€éµä¿®å¾© Token...');
            
            // æ¸…é™¤æ‰€æœ‰èˆŠè³‡æ–™
            localStorage.clear();
            sessionStorage.clear();
            
            // è¨­ç½®æ–°çš„æœ‰æ•ˆ Token å’Œå®Œæ•´ç”¨æˆ¶è³‡è¨Š
            localStorage.setItem('token', newToken);
            localStorage.setItem('staffName', 'ç³»çµ±ç®¡ç†å“¡');
            localStorage.setItem('staffRole', 'admin');
            localStorage.setItem('staffUsername', 'sunnyharry1');
            localStorage.setItem('staffId', '1');
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('loginTime', new Date().toISOString());
            localStorage.setItem('tokenFixTime', new Date().toISOString());
            
            // è¨­ç½® sessionStorage
            sessionStorage.setItem('userLoggedIn', 'true');
            sessionStorage.setItem('currentUser', JSON.stringify({
                id: 1,
                username: 'sunnyharry1',
                name: 'ç³»çµ±ç®¡ç†å“¡',
                role: 'admin'
            }));
            
            console.log('âœ… Token ä¸€éµä¿®å¾©å®Œæˆï¼');
            
            // é¡¯ç¤ºæˆåŠŸæ¶ˆæ¯
            document.getElementById('successAlert').style.display = 'block';
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const btn = document.querySelector('.btn-instant');
            btn.innerHTML = '<i class="fas fa-check me-2"></i>ä¿®å¾©å®Œæˆ';
            btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
        }
        
        function copyCode() {
            const code = document.getElementById('fixCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('âœ… ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼\\nè«‹åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­è²¼ä¸Šä¸¦æŒ‰ Enter');
            }).catch(() => {
                // å‚™ç”¨è¤‡è£½æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ä»£ç¢¼å·²è¤‡è£½ï¼è«‹åœ¨æ§åˆ¶å°ä¸­è²¼ä¸Š');
            });
        }
        
        async function testToken() {
            try {
                const response = await fetch('https://echochat-api.onrender.com/api/me', {
                    headers: {
                        'Authorization': `Bearer ${newToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`âœ… Token æ¸¬è©¦æˆåŠŸï¼\\nç”¨æˆ¶: ${data.user.name}\\nè§’è‰²: ${data.user.role}\\nç‹€æ…‹: æ­£å¸¸é‹ä½œ`);
                } else {
                    alert(`âŒ Token æ¸¬è©¦å¤±æ•—\\nç‹€æ…‹ç¢¼: ${response.status}\\nè«‹é‡æ–°ä¿®å¾©`);
                }
            } catch (error) {
                alert('âŒ æ¸¬è©¦å¤±æ•—: ' + error.message);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç•¶å‰ç‹€æ…‹
        window.addEventListener('load', () => {
            const currentToken = localStorage.getItem('token');
            if (currentToken && currentToken === newToken) {
                document.getElementById('successAlert').style.display = 'block';
                const btn = document.querySelector('.btn-instant');
                btn.innerHTML = '<i class="fas fa-check me-2"></i>å·²ä¿®å¾©';
                btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            }
        });
    </script>
</body>
</html>